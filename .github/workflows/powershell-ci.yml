name: PowerShell CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint-and-test:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup PowerShell
        uses: actions/setup-powershell@v2

      - name: Install PSScriptAnalyzer
        shell: pwsh -l -c
        run: |
          Install-Module -Name PSScriptAnalyzer -Force -Scope CurrentUser -Repository PSGallery

      - name: Run PSScriptAnalyzer
        shell: pwsh -l -c
        run: |
          Invoke-ScriptAnalyzer -Path . -Recurse -Severity Error

      - name: Install Pester
        shell: pwsh -l -c
        run: |
          Install-Module -Name Pester -Force -Scope CurrentUser -Repository PSGallery

      - name: Run Pester tests (if any)
        shell: pwsh -l -c
        run: |
          if (Test-Path ./tests) { Invoke-Pester -Path ./tests -EnableExit } else { Write-Host 'No tests directory; skipping Invoke-Pester.' }
